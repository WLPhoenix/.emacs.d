from .. import ingest_tasks
from qatp_core.qatp.tasks import QATPWorkflow

class QueriesOnly(QATPWorkflow):
    _name = 'ingest.queries_only'
        
    def get_name(self):
        return QueriesOnly._name

        
    def get_required_config(self):
        return [
            {
                'api_root' : str,
                'kb' : str,
                'queries' : str
            }
        ]

        
    def get_optional_config(self):
        return {
            'secure' : bool,
            'secure_auth_level' : str,
        }

        
    def _init_initial_state(self):
        self.initial_state = {
            'config' : {
                'ingets.run_queries' : { 'queries' : self.config['queries'] }
            },
            'synthesys' : {
                'kb' : self.config['kb'],
                'server' : {
                    'url' : self.config['api_root']
                }
            }
        }
        if self.config.get('secure_auth_level'): 
            self.initial_state['secure'] = True
            self.initial_state['secure_auth_level'] = self.config['secure_auth_level']

        
    def _init_tasks(self):
        self.tasks = [
            'ingest.run_queries'
        ]


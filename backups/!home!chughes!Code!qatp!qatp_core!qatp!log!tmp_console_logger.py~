import errno
import logging
import os
import sys

def init(config):
    con_log = get_logger()
    con_log.handlers = []
    con_format = logging.Formatter(config['format'], datefmt=config['datefmt'])
    
    if config['to_stream']:
        stream_handler = logging.StreamHandler()
        stream_handler.setFormatter(con_format)
        con_log.addHandler(stream_handler)
        
    if config['to_file']:
        logfile = config['path']
        try:
            os.makedirs(os.path.dirname(logfile))
        except OSError, e:
            if e.errno != errno.EEXIST:
                raise
                
        sys.stderr.write("Console output: %s\n" % logfile)
        file_handler = logging.FileHandler(logfile)
        file_handler.setFormatter(con_format)
        con_log.addHandler(file_handler)
        
    con_log.setLevel(logging.getLevelName(config['level']))

def get_logger():
    return logging.getLogger('qatp')
    
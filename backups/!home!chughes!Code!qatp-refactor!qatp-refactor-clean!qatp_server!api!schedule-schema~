{
    "conditionalAction": [
        {
            "condition": "mappings.processType == null",
            "endpointAction": {
                "entity": {},
                "uri": "/app",
                "verb": "GET"
            },
            "responseStatements": [
                "mappings.processType=mappings.cdh4=='true' ? 'oozie-cdh4' : 'oozie'"
            ]
        },
        {
            "condition": "mappings.processType != null && mappings.kbName != null && mappings.rivuletId == null && !mappings.errorMessage",
            "endpointAction": {
                "entity": {
                    "application": "rivulet",
                    "invocationConfig": {
                        "input_rawText": "$input"
                    },
                    "kb": "$kbName",
                    "processType": "$processType"
                },
                "uri": "/process?expandErrors=true",
                "verb": "POST"
            },
            "responseStatements": [
                "mappings.rivuletId=response.id",
                "mappings.errorDetails=response.errorDetails",
                "mappings.errorMessage=response.errorMessage"
            ]
        },
        {
            "condition": "mappings.frequenciesId == null && now.rivulet?.status == 'COMPLETE' && !mappings.errorMessage",
            "endpointAction": {
                "entity": {
                    "application": "frequencies",
                    "kb": "$kbName",
                    "processType": "$processType"
                },
                "uri": "/process",
                "verb": "POST"
            },
            "responseStatements": [
                "mappings.frequenciesId=response.id",
                "mappings.errorDetails=response.errorDetails",
                "mappings.errorMessage=response.errorMessage"
            ]
        },
        {
            "condition": "mappings.resonanceId == null && now.rivulet?.status == 'COMPLETE' && !mappings.errorMessage",
            "endpointAction": {
                "entity": {
                    "application": "resonance",
                    "kb": "$kbName",
                    "processType": "$processType"
                },
                "uri": "/process",
                "verb": "POST"
            },
            "responseStatements": [
                "mappings.resonanceId=response.id",
                "mappings.errorDetails=response.errorDetails",
                "mappings.errorMessage=response.errorMessage"
            ]
        },
        {
            "condition": "mappings.knowledgeObjectsId == null && now.rivulet?.status == 'COMPLETE' && now.resonance?.status == 'COMPLETE' && !mappings.errorMessage",
            "endpointAction": {
                "entity": {
                    "application": "knowledgeobjects",
                    "kb": "$kbName",
                    "processType": "$processType"
                },
                "uri": "/process",
                "verb": "POST"
            },
            "responseStatements": [
                "mappings.knowledgeObjectsId=response.id",
                "mappings.errorDetails=response.errorDetails",
                "mappings.errorMessage=response.errorMessage"
            ]
        },
        {
            "condition": "mappings.hive == 'true' && mappings.hiveSetupScriptExitValue == null && now.knowledgeobjects?.status == 'COMPLETE' && !mappings.errorMessage",
            "endpointAction": {
                "entity": {},
                "uri": "/app",
                "verb": "GET"
            },
            "responseStatements": [
                "mappings.hiveSetupScriptExitValue=[mappings.hiveSetupScript, mappings.kbName, mappings.hiveWarehouse].execute().exitValue()"
            ]
        },
        {
            "condition": "mappings.associativenetId == null && now.frequencies?.status == 'COMPLETE' && !mappings.errorMessage",
            "endpointAction": {
                "entity": {
                    "application": "associativenet",
                    "kb": "$kbName",
                    "processType": "$processType"
                },
                "uri": "/process",
                "verb": "POST"
            },
            "responseStatements": [
                "mappings.associativenetId=response.id",
                "mappings.errorDetails=response.errorDetails",
                "mappings.errorMessage=response.errorMessage"
            ]
        },
        {
            "condition": "now.rivulet?.status == 'FAILED' || now.frequencies?.status == 'FAILED' || now.resonance?.status == 'FAILED' || now.associativenet?.status == 'FAILED' || now.knowledgeobjects?.status == 'FAILED' || mappings.errorMessage",
            "endpointAction": {
                "entity": {
                    "status": "STOPPING"
                },
                "uri": "/scheduler/schedule/$id",
                "verb": "PATCH"
            }
        },
        {
            "condition": "now.rivulet?.status == 'COMPLETE' && now.frequencies?.status == 'COMPLETE' && now.resonance?.status == 'COMPLETE' && now.associativenet?.status == 'COMPLETE' && now.knowledgeobjects?.status == 'COMPLETE' && (mappings.hive == 'false' || mappings.hiveSetupScriptExitValue != null)",
            "endpointAction": {
                "entity": {
                    "status": "STOPPING"
                },
                "uri": "/scheduler/schedule/$id",
                "verb": "PATCH"
            }
        }
    ],
    "mappings": {
        "cdh4": "true",
        "hive": "false",
        "hiveSetupScript": "./views/defaultHiveImpala/hiveImpalaSetup.sh",
        "hiveWarehouse": "/user/hive/warehouse",
        "input": "",
        "kbName": ""
    },
    "resources": {
        "associativenet": "/process/$associativenetId",
        "frequencies": "/process/$frequenciesId",
        "kb": "/kb/$kbName",
        "knowledgeobjects": "/process/$knowledgeObjectsId",
        "resonance": "/process/$resonanceId",
        "rivulet": "/process/$rivuletId"
    },
    "templateName": "synthesys-batch-ingestion"
}

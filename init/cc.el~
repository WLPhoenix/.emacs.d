;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;                               C-flavored modes                             ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(setq c-backward-function 'backward-delete-char)

(c-add-style "wlphoenix"
  '("java"
	 ;; Offsets
	 (c-basic-offset . 4)
	 (tab-width . 4)
	 (indent-tabs-mode . t)
	 (c-offsets-alist
	   (substatement-open . 0))
  )
)

(c-add-style "digitalreasoning"
  '("wlphoenix"
 	 (c-hanging-braces-alist
	   ((substatement-open)
		(block-close . c-snug-do-while)
		(extern-lang-open after)
		(inexpr-class-open after)
		(inexpr-class-close before)))
   )
)

(setq c-default-style "digitalreasoning")

;;; C mode
(add-hook 'c-mode (get-c-style-hook))

;;; C++ mode
(add-hook 'c++-mode (get-c-style-hook))

;;; Java mode
(add-hook 'java-mode (get-c-style-hook))
(define-key java-mode-map (kbd "<return>") 'newline-and-indent)

(require 'cedit)
(require 'semantic)
(require 'yasnippet)
(load "semantic/loaddefs.el")
(add-hook 'java-mode
  (lambda ()
    (semantic-mode 1)
	(yas-minor-mode t)
  ))


;;; Malabar mode (extends java-mode)
(require 'malabar-mode)
(add-hook 'malabar-mode (get-c-style-hook))
(add-to-list 'auto-mode-alist '("\\.java\\'" . malabar-mode))
(add-hook 'malabar-mode
  (lambda ()
    ;; Compile file after save
    (add-hook 'after-save-hook 'malabar-compile-file-silently nil t)
  ))
